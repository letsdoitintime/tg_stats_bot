[program:tgstats-bot]
command=/TelegramBots/Chat_Stats/venv/bin/python -m tgstats.bot_main
directory=/TelegramBots/Chat_Stats
user=root
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/TelegramBots/Chat_Stats/logs/bot.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=10
stderr_logfile=/TelegramBots/Chat_Stats/logs/bot_error.log
stderr_logfile_maxbytes=50MB
stderr_logfile_backups=10

; CPU limit: 50% of one core
; Note: Requires supervisor-with-cgroup or manual cgroup setup
environment=CPU_LIMIT="0.5"

; Process priority (higher number = lower priority)
priority=10

; Graceful shutdown
stopwaitsecs=30
stopsignal=TERM

[program:tgstats-celery]
command=/TelegramBots/Chat_Stats/venv/bin/celery -A tgstats.celery_tasks worker --loglevel=info --concurrency=2 --max-tasks-per-child=100 --max-memory-per-child=500000
directory=/TelegramBots/Chat_Stats
user=root
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/TelegramBots/Chat_Stats/logs/celery.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=10
stderr_logfile=/TelegramBots/Chat_Stats/logs/celery_error.log
stderr_logfile_maxbytes=50MB
stderr_logfile_backups=10

environment=CPU_LIMIT="0.5"
priority=15
stopwaitsecs=60
stopsignal=TERM

[program:tgstats-celery-beat]
command=/TelegramBots/Chat_Stats/venv/bin/celery -A tgstats.celery_tasks beat --loglevel=info
directory=/TelegramBots/Chat_Stats
user=root
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/TelegramBots/Chat_Stats/logs/celery_beat.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=10
stderr_logfile=/TelegramBots/Chat_Stats/logs/celery_beat_error.log
stderr_logfile_maxbytes=50MB
stderr_logfile_backups=10

environment=CPU_LIMIT="0.25"
priority=20
stopwaitsecs=10
stopsignal=TERM

[program:tgstats-api]
command=/TelegramBots/Chat_Stats/venv/bin/uvicorn tgstats.web.app:app --host 0.0.0.0 --port 8000 --log-level warning --workers 2
directory=/TelegramBots/Chat_Stats
user=root
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/TelegramBots/Chat_Stats/logs/api.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=10
stderr_logfile=/TelegramBots/Chat_Stats/logs/api_error.log
stderr_logfile_maxbytes=50MB
stderr_logfile_backups=10

environment=CPU_LIMIT="0.5"
priority=10
stopwaitsecs=30
stopsignal=TERM

[group:tgstats]
programs=tgstats-bot,tgstats-celery,tgstats-celery-beat,tgstats-api
priority=999
